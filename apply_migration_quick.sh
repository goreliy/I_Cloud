#!/bin/bash
# Быстрый скрипт для применения миграций (использует текущую директорию)

set -e

echo "=== Применение миграций базы данных ==="
echo "Текущая директория: $(pwd)"

# Проверка наличия файлов проекта
if [ ! -f "alembic.ini" ]; then
    echo "Ошибка: файл alembic.ini не найден"
    echo "Запустите скрипт из корня проекта"
    exit 1
fi

# Активировать виртуальное окружение
if [ -d "venv" ]; then
    echo "Активация виртуального окружения..."
    source venv/bin/activate
elif [ -d ".venv" ]; then
    echo "Активация виртуального окружения (.venv)..."
    source .venv/bin/activate
else
    echo "Предупреждение: виртуальное окружение не найдено"
    echo "Продолжаем без активации..."
fi

# Проверить текущую ревизию
echo ""
echo "Текущая ревизия базы данных:"
alembic current || echo "База данных не инициализирована"

echo ""
echo "Применение миграций до последней версии..."
alembic upgrade head

echo ""
echo "=== Миграции применены успешно ==="
echo ""
echo "Текущая ревизия:"
alembic current

