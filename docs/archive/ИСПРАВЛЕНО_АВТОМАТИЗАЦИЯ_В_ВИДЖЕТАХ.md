# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤ –≤–∏–¥–∂–µ—Ç–∞—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –≤–∏–¥–∂–µ—Ç-–ø–æ–ª–∑—É–Ω–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `field1`), –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä `field2`) –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª–∞ —Ä–∞–±–æ—Ç–∞—Ç—å.

**–ü—Ä–∏–º–µ—Ä:**

```
–ü—Ä–∞–≤–∏–ª–æ: IF field1 > 5 THEN field2 = field2 - 1

–í–∏–¥–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: field1 = 10
–û–∂–∏–¥–∞–ª–æ—Å—å: field2 —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1
–†–µ–∞–ª—å–Ω–æ—Å—Ç—å: field2 = None (—Å–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å)
```

## –ü—Ä–∏—á–∏–Ω–∞

Endpoint `/api/channels/{id}/control` —Å–æ–∑–¥–∞–≤–∞–ª feed —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º –ø–æ–ª–µ–º:

```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
feed_data_dict = {f'field{i}': None for i in range(1, 9)}
feed_data_dict['field1'] = 10  # –¢–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø–æ–ª–µ
# –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è = None!
```

## –†–µ—à–µ–Ω–∏–µ

–ü—Ä–∏–º–µ–Ω–∏–ª **—Ç—É –∂–µ –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–æ–ª–µ–π**, —á—Ç–æ –∏ –≤ `/update`:

```python
# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
output_fields = get_output_fields(channel_id, db)
last_feed = get_last_feed(db, channel_id)

for each field:
  if field == –æ–±–Ω–æ–≤–ª—è–µ–º–æ–µ:
    value = –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  elif field –≤ –≤—ã—Ö–æ–¥–Ω—ã—Ö –ò –µ—Å—Ç—å last_feed:
    value = –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ last_feed  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å!
  else:
    value = None
```

**–¢–µ–ø–µ—Ä—å:**
- –û–±–Ω–æ–≤–ª—è–µ–º–æ–µ –ø–æ–ª–µ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –í—ã—Ö–æ–¥–Ω—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è = None
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

---

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ

```
–ü—Ä–∞–≤–∏–ª–æ: IF field1 > 5 THEN field2 = field2 - 1

–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: field1=0, field2=10

–í–∏–¥–∂–µ—Ç: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å field1 = 10
‚Üí field2 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (10), –ø—Ä–∞–≤–∏–ª–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: field1=10, field2=9 ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª

```
–ü—Ä–∞–≤–∏–ª–æ 1: IF field1 > 5 THEN field2 = field2 - 1
–ü—Ä–∞–≤–∏–ª–æ 2: IF field1 < 1 THEN field2 = field2 + 1

–ù–∞—á–∞–ª—å–Ω–æ–µ: field1=10, field2=50

–í–∏–¥–∂–µ—Ç: field1 = 10
‚Üí field2=50 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
‚Üí –ü—Ä–∞–≤–∏–ª–æ 1 —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç (10 > 5)
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: field1=10, field2=49 ‚úÖ

–í–∏–¥–∂–µ—Ç: field1 = 10 (—Å–Ω–æ–≤–∞)
‚Üí field2=49 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
‚Üí –ü—Ä–∞–≤–∏–ª–æ 1 —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: field1=10, field2=48 ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–ò–î-—Ä–µ–≥—É–ª—è—Ç–æ—Ä

```
–ü—Ä–∞–≤–∏–ª–æ: PID field1 ‚Üí field2 (Setpoint=25)

field1 = –¥–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
field2 = –º–æ—â–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è

–í–∏–¥–∂–µ—Ç –¥–ª—è field1 (–¥–∞—Ç—á–∏–∫):
‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
‚Üí field2 (–º–æ—â–Ω–æ—Å—Ç—å) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚Üí –ü–ò–î-—Ä–µ–≥—É–ª—è—Ç–æ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –º–æ—â–Ω–æ—Å—Ç—å
‚Üí –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ
```

---

## –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

**–§–∞–π–ª:** `app/routers/control.py` (—Å—Ç—Ä–æ–∫–∏ 78-101)

**–î–æ:**
```python
feed_data_dict = {f'field{i}': None for i in range(1, 9)}
feed_data_dict[field_update.field_name] = field_update.value
```

**–ü–æ—Å–ª–µ:**
```python
output_fields = get_output_fields(channel_id, db)
last_feed = feed_service.get_last_feed(db, channel_id) if output_fields else None

feed_data_dict = {}
for i in range(1, 9):
    field_name = f'field{i}'
    if field_name == field_update.field_name:
        feed_data_dict[field_name] = field_update.value
    elif field_name in output_fields and last_feed:
        feed_data_dict[field_name] = getattr(last_feed, field_name, None)
    else:
        feed_data_dict[field_name] = None
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** +18 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–∞–≤–∏–ª–æ —Å —É–º–µ–Ω—å—à–µ–Ω–∏–µ–º

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ: IF field1 > 5 THEN field2 = field2 - 1

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ API
curl "http://localhost:8000/update?api_key=YOUR_KEY&field1=10&field2=100"

# –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏–¥–∂–µ—Ç –¥–ª—è field1
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–∑—É–Ω–æ–∫ –Ω–∞ 10
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: field2 –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å 99 (–Ω–µ None!) ‚úÖ
```

### –¢–µ—Å—Ç 2: –í–∏–¥–∂–µ—Ç + –ü–ò–î

```
1. –°–æ–∑–¥–∞–π—Ç–µ –ü–ò–î –ø—Ä–∞–≤–∏–ª–æ: field1 ‚Üí field2 (Setpoint=25)
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–∂–µ—Ç-–ø–æ–ª–∑—É–Ω–æ–∫ –¥–ª—è field1 (0-100¬∞C)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–æ–ª–∑—É–Ω–æ–∫
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ field1 –∏ field2
5. field2 –¥–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è! ‚úÖ
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–í–∏–¥–∂–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π**  
‚úÖ **–í—ã—Ö–æ–¥–Ω—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**  
‚úÖ **–ü–ò–î-—Ä–µ–≥—É–ª—è—Ç–æ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç**  
‚úÖ **–ú–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –≤—Ö–æ–¥–Ω—ã–º–∏ –ø–æ–ª—è–º–∏**  
‚úÖ **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**  

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å –≤–∏–¥–∂–µ—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã** —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

**–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:**

```bash
python run.py
```

**http://localhost:8000**

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üöÄ**




