# Техническое описание системы IBolid Cloud

## Общая информация

**IBolid Cloud** — облачная платформа для сбора, хранения, визуализации и анализа данных от IoT устройств. Система построена на базе FastAPI и предоставляет REST API для интеграции с внешними устройствами, веб-интерфейс для управления и визуализации данных, а также расширенные возможности автоматизации и кастомизации.

### Версия системы
- **Версия**: 1.0.0
- **Дата создания документации**: 2025-12-23

## Архитектура системы

Система построена по модульной архитектуре и состоит из следующих основных компонентов:

```
IBolid Cloud
├── Backend API (FastAPI)
│   ├── Модуль аутентификации и авторизации
│   ├── Модуль управления каналами
│   ├── Модуль работы с данными (Feeds)
│   ├── Модуль виджетов
│   ├── Модуль автоматизации
│   ├── Модуль архивации данных
│   ├── Модуль администрирования
│   └── Модуль мониторинга и логирования
├── Frontend (Web Interface)
│   ├── Веб-интерфейс управления
│   ├── Визуализация данных
│   ├── Админ-панель
│   └── Профили пользователей
└── Database Layer
    ├── Основная БД (SQLite/PostgreSQL)
    └── Архивная БД (SQLite/PostgreSQL)
```

## Основные возможности

### 1. Управление данными IoT
- Прием данных от устройств через REST API
- Хранение до 8 полей данных на канал
- Поддержка геолокации (широта, долгота, высота)
- Статусные сообщения
- Экспорт данных в JSON, XML, CSV

### 2. Аутентификация и безопасность
- JWT токены для веб-интерфейса
- API ключи для доступа к каналам (read/write)
- Гибкая система прав доступа
- Возможность отключения аутентификации для публичных проектов

### 3. Визуализация данных
- Графики в реальном времени (Chart.js)
- Кастомные виджеты (SVG, HTML/CSS/JS)
- AI-генерация виджетов
- Версионирование виджетов

### 4. Автоматизация
- Правила автоматизации на основе условий
- PID контроллеры
- Выражения для вычислений
- Приоритизация правил

### 5. Архивация данных
- Автоматическая архивация старых данных
- Поддержка SQLite и PostgreSQL для архива
- Настраиваемый период хранения
- Планировщик задач

### 6. Администрирование
- Админ-панель с метриками системы
- Управление пользователями и каналами
- Мониторинг API запросов
- Системные метрики (CPU, RAM, Disk)

## Структура документации

Документация разделена на следующие разделы:

1. **[Общий обзор системы](README.md)** (этот файл)
2. **[ТЗ Backend API](Backend/API_SPECIFICATION.md)** — спецификация REST API
3. **[ТЗ Frontend](Frontend/FRONTEND_SPECIFICATION.md)** — спецификация веб-интерфейса
4. **[Описание модулей Backend](Backend/MODULES.md)** — детальное описание backend модулей
5. **[Описание модулей Frontend](Frontend/MODULES.md)** — детальное описание frontend модулей
6. **[Архитектурный план](ARCHITECTURE.md)** — как все компоненты интегрируются
7. **[Модуль автоматизации и PID регуляторы](AUTOMATION.md)** — подробное описание автоматизации, PID регуляторов и правил обработки данных

## Технологический стек

### Backend
- **Framework**: FastAPI 0.104.1
- **ASGI Server**: Uvicorn 0.24.0
- **ORM**: SQLAlchemy 2.0.23
- **Миграции**: Alembic 1.12.1
- **Валидация**: Pydantic 2.5.0
- **Аутентификация**: python-jose[cryptography] 3.3.0
- **Хеширование**: bcrypt >= 4.0.0
- **Обработка изображений**: Pillow 10.1.0
- **Мониторинг**: psutil 5.9.6
- **Выражения**: asteval 0.9.31

### Frontend
- **Шаблонизатор**: Jinja2 3.1.2
- **CSS Framework**: Bootstrap 5.3.0
- **Иконки**: Bootstrap Icons 1.11.0
- **Графики**: Chart.js 4.4.0
- **Zoom для графиков**: chartjs-plugin-zoom 2.0.1

### База данных
- **Основная БД**: SQLite (по умолчанию) или PostgreSQL
- **Архивная БД**: SQLite (по умолчанию) или PostgreSQL

## Режимы работы

### С аутентификацией (AUTH_ENABLED=true)
- Требуется регистрация пользователей
- Каналы привязаны к пользователям
- API ключи обязательны для записи/чтения
- Доступна админ-панель
- Приватные и публичные каналы

### Без аутентификации (AUTH_ENABLED=false)
- Открытый доступ ко всем endpoints
- Не требуется регистрация
- API ключи опциональны
- Все каналы публичные

## Производительность

### Оптимизации
- In-memory буфер записи данных (mem_buffer)
- Кэширование API ключей
- Пул соединений с БД
- Настройки SQLite WAL режима
- Батчинг операций записи

### Ограничения
- Максимум 50,000 записей в очереди буфера
- Размер батча: 200 записей
- Интервал сброса буфера: 100ms
- Максимальная задержка: 500ms

## Безопасность

- JWT токены с настраиваемым временем жизни
- Хеширование паролей (bcrypt)
- Валидация API ключей
- Rate limiting (в production режиме)
- Логирование всех API запросов
- CORS настройки

## Развертывание

### Требования
- Python 3.8+
- SQLite или PostgreSQL
- 512MB RAM минимум
- 1GB свободного места на диске

### Конфигурация
Все настройки системы находятся в файле `.env` или переменных окружения. Основные параметры:
- `DATABASE_TYPE` — тип БД (sqlite/postgresql)
- `DATABASE_URL` — URL подключения к БД
- `AUTH_ENABLED` — включение/выключение аутентификации
- `JWT_SECRET_KEY` — секретный ключ для JWT
- `MEMBUFFER_ENABLED` — включение буфера записи
- `ROOT_PATH` — префикс пути для работы за реверс-прокси

## Дополнительная документация

- [README проекта](../README.md) — общая информация о проекте
- [Документация архива](../docs/ARCHIVE_INDEX.md) — архивные материалы
- [Настройка реверс-прокси](../REVERSE_PROXY_SETUP.md) — настройка nginx

## Контакты и поддержка

Для вопросов и предложений обращайтесь к разработчикам проекта.

