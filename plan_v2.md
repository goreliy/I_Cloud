# План улучшения генератора ИИ-виджетов

1. Админская панель ИИ сервисов
- Создать страницу `/admin/ai-services` (шаблон `app/templates/admin/ai_services.html`) для управления списком сервисов (DeepSeek, Qwen, ChatGPT).
- Функции: список сервисов, создание/редактирование/удаление, включение/выключение, сортировка, редактирование дефолтных предпромптов (общий, HTML, CSS, JS, refine).
- Работать через уже реализованные API: `GET/POST/PUT/DELETE /api/ai-services`.

2. Выбор сервиса при создании/редактировании виджета
- В `channel_widgets.html` и `widget_edit.html` добавить явный выбор сервиса (кнопки/выпадающий список), кнопку «Открыть в новой вкладке», и fallback, если iframe заблокирован.
- При выборе сервиса загружать предпромпты и подставлять URL в iframe.

3. Поле пользовательского задания (prompt builder)
- Добавить textarea «Ваше задание» (описание желаемого виджета).
- Добавить «Сформированный промпт» (readonly) — объединение: общий предпромпт + данные канала + подсказки HTML/CSS/JS + текст пользователя.
- Кнопки: «Скопировать промпт», «Обновить».

4. Автогенерация промпта на бэкенде
- Расширить endpoint `GET /api/channels/{channel_id}/widgets/prompt` параметром `user_request`.
- Возвращать поле `full_prompt` — готовый промпт, включающий пользовательский запрос и подсказки по структуре ответа (HTML/CSS/JS).

5. UX ответа ИИ
- Подсказки рядом с полями: как вставлять сырой ответ и парсить на HTML/CSS/JS.
- Визуальный статус активного сервиса, уведомления об успехе вставки.

6. Документация и помощь
- Модалка «Как пользоваться»: пошагово — выбрать сервис, сформировать промпт, скопировать, получить ответ, распарсить, вставить, сохранить.
- Обновить README.

7. Тестирование
- Ручные сценарии: CRUD сервисов, выбор сервиса, генерация/уточнение промпта, парсинг ответа, сохранение версии, откат версии.
- Smoke-тесты UI (при наличии).

